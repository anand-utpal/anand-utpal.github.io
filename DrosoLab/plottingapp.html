<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Manual: Fly Behavioral Analysis Tool</title>
    <style>
        body {
            font-family: 'Times New Roman', Times, serif;
            line-height: 1.6;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
        }

        .a4-container {
            width: 21cm;
            min-height: 29.7cm;
            padding: 2cm;
            margin: 1cm auto;
            border: 1px #D3D3D3 solid;
            background: white;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }

        h1,
        h2,
        h3 {
            font-family: 'Georgia', serif;
            color: #333;
        }

        h1 {
            text-align: center;
            font-size: 24pt;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
            margin-bottom: 1.5em;
        }

        h2 {
            font-size: 18pt;
            margin-top: 1.5em;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }

        h3 {
            font-size: 14pt;
            margin-top: 1.2em;
            color: #444;
        }

        p,
        li {
            font-size: 12pt;
            text-align: justify;
        }

        ul,
        ol {
            padding-left: 20px;
        }

        li {
            margin-bottom: 0.5em;
        }

        strong,
        b {
            color: #000;
        }

        .note {
            background-color: #e8f4fd;
            border-left: 4px solid #2196F3;
            padding: 10px 15px;
            margin: 1em 0;
        }

        .code {
            font-family: 'Courier New', Courier, monospace;
            background-color: #eef;
            padding: 1px 4px;
            border-radius: 3px;
        }

        @media print {

            body,
            .a4-container {
                margin: 0;
                box-shadow: none;
                border: none;
                background: white;
            }
        }
        /* --- NEW MENU STYLES --- */
.menu-container {
    position: absolute;
    top: 25px;
    left: 25px;
    z-index: 10;
}

.menu-icon {
    cursor: pointer;
    padding: 5px;
}

.menu-icon .bar {
    display: block;
    width: 25px;
    height: 3px;
    background-color: #555;
    margin: 5px 0;
}

.menu-content {
    display: none;
    /* Hidden by default */
    position: absolute;
    top: 100%;
    left: 0;
    background-color: #ffffff;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 15px;
    min-width: 180px;
}

.menu-content h4 {
    margin-top: 0;
    margin-bottom: 10px;
    color: #1e88e5;
}

.menu-content ul {
    list-style: none;
    padding: 0;
    margin: 0;
    text-align: left;
}

.menu-content ul li {
    padding: 8px 5px;
    font-size: 14px;
}

/* Show menu on hover */
.menu-container:hover .menu-content {
    display: block;
}
        /* Show menu on hover */
.menu-container:hover .menu-content {
    display: block;
}
        .menu-container {
            position: absolute;
            top: 25px;
            /* ...and so on for all the menu CSS... */
        }
        
        .menu-container:hover .menu-content {
            display: block;
        }
    </style>
</head>

<body>
    <div class="flowchart-container">

        <div class="menu-container">
            <div class="menu-icon">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
            <div class="menu-content">
                <h4>Contents</h4>
                <ul>
                    <li><a href="https://theutpalanand.github.io/DrosoLab/coverpage.html">Chapter 1: Cover Page</a></li>
                    <li><a href="https://theutpalanand.github.io/DrosoLab/main.html">Chapter 2: Framework</a></li>
                    <li><a href="https://theutpalanand.github.io/DrosoLab/page1.html">Chapter 3: Tracking Principles</a></li>
                    <li><a href="https://theutpalanand.github.io/DrosoLab/funtionsmain.html">Chapter 4: Experimental Interface</a></li>
                    <li><a href="https://theutpalanand.github.io/DrosoLab/calibration.html">Chapter 5: Calibration on Image</a></li>
                    <li><a href="https://theutpalanand.github.io/DrosoLab/htmlcalibration.html">Chapter 6: Calibration on Data</a></li>
                    <li><a href="https://theutpalanand.github.io/DrosoLab/analysis.html">Chapter 7: Analysis</a></li>
                    <li><a href="https://theutpalanand.github.io/DrosoLab/plottingapp.html">Chapter 8: Plotting App</a></li>
                    <li><a href="https://theutpalanand.github.io/DrosoLab/labeledroi.html">Chapter 9: Labeling ROI</a></li>
                    <li><a href="https://theutpalanand.github.io/DrosoLab/videomaking.html">Chapter 10: Video Making</a></li>
                    <li><a href="https://theutpalanand.github.io/DrosoLab/error%20and%20working.html">Chapter 11: Error and Working</a></li>
                </ul>
            </div>
        </div>

        </div>

    <div class="a4-container">
        <h1>User Manual: Fly Behavioral Analysis Tool</h1>

        <h2>1. Overview & Purpose ðŸ“ˆ</h2>
        <p>
            The <strong>Fly Behavioral Analysis Tool</strong> is a comprehensive data analysis and visualization
            application. It is designed to work with the output files from the "Fly Tracking Analysis" script
            (specifically <code class="code">sorted_output.csv</code> and <code class="code">dam.csv</code>). Its
            purpose is to quantify and compare complex behavioral metrics across different experimental groups,
            generating publication-quality plots and data summaries.
        </p>
        <p>
            The tool allows you to define experimental groups, exclude subjects, select specific time windows for
            analysis, and convert pixel-based measurements into real-world units (millimeters).
        </p>

        <hr>

        <h2>2. A Step-by-Step Guide to Using the Tool</h2>
        <p>The interface is organized into a logical workflow from top to bottom on the left control panel.</p>

        <h3>Step 1: Loading Data</h3>
        <p>In the "File Loading" section, you must load the data you wish to analyze.</p>
        <ul>
            <li><strong>Load Coordinates CSV:</strong> Click to select your <code class="code">sorted_output.csv</code>
                file. This file contains the frame-by-frame position of each fly and is required for all
                coordinate-based analyses.</li>
            <li><strong>Load DAM CSV:</strong> Click to select your <code class="code">dam.csv</code> file. This
                contains the activity counts (line crossings) and is required for all DAM-based analyses.</li>
        </ul>
        <div class="note">After loading, the time dropdown menus will be populated with the timestamps from your files.
        </div>

        <h3>Step 2: Defining Groups and Exclusions</h3>
        <p>The "Group & Fly Management" section allows you to structure your experiment for comparison.</p>
        <ul>
            <li><strong>Group Definitions:</strong> Define your experimental groups using the format <code
                    class="code">GroupName:FlyRange;GroupName2:FlyRange2</code>. For example: <code
                    class="code">Control:1-10;Treated:11-20</code>. If left blank, all flies will be treated as a single
                group named "All_Flies".</li>
            <li><strong>Exclusions:</strong> Enter the numbers of any flies you wish to exclude from all analyses,
                separated by commas (e.g., <code class="code">5,8,12</code>).</li>
        </ul>

        <h3>Step 3: Setting Up Coordinate Transformation (Optional)</h3>
        <p>The "Homography Settings" section is used to convert pixel coordinates into real-world units (e.g.,
            millimeters). <strong>This is only necessary if you plan to run a "(Length-based)" analysis.</strong></p>
        <ul>
            <li><strong>Image Corner Points:</strong> Enter the pixel coordinates of four known points that form a
                rectangle in the real world (e.g., the corners of a calibration card). Format is <code
                    class="code">x,y</code>.</li>
            <li><strong>Real Side Lengths (mm):</strong> Enter the actual lengths of the top and right sides of that
                real-world rectangle in millimeters, formatted as <code class="code">Top,Right,Bottom,Left</code>.</li>
            <li><strong>Update Homography:</strong> Click this to calculate the transformation matrix.</li>
        </ul>

        <h3>Step 4: Configuring and Running an Analysis</h3>
        <p>This is the core of the tool, where you select what to measure and plot.</p>
        <ul>
            <li><strong>Analysis Type:</strong> Choose the specific behavioral metric you want to calculate from the
                extensive dropdown list. A detailed explanation of each type is in the Appendix.</li>
            <li><strong>Time Range Selection:</strong> Define the window for your analysis.
                <ul>
                    <li><strong>Start Time:</strong> Select the beginning of the analysis period.</li>
                    <li><strong>End Time:</strong> (Optional) Select a specific end time.</li>
                    <li><strong>Interval (minutes):</strong> (Optional) If no end time is selected, enter a duration in
                        minutes. The analysis will run from the start time for this interval.</li>
                </ul>
            </li>
            <li><strong>Time-series Fly Selection:</strong> If you choose the "Time-series Plots" analysis, use these
                spin boxes to select the two specific flies you wish to compare directly. The checkbox allows you to
                toggle between pixel and real-world units for the plot.</li>
            <li><strong>Generate Plot:</strong> Click this button to run the selected analysis on the defined groups and
                time range. The result will be displayed in the plot panel on the right.</li>
        </ul>

        <h3>Step 5: Saving Your Results</h3>
        <p>After a plot has been generated, you can save your work using the "Actions" buttons.</p>
        <ul>
            <li><strong>Save Plot:</strong> Saves the currently displayed plot as a high-resolution PNG image file.</li>
            <li><strong>Save Data:</strong> Saves the underlying data used to generate the plot (e.g., the calculated
                locomotor activity value for each fly) into a new CSV file.</li>
        </ul>

        <hr>

        <h2>Appendix: Analysis Types Explained</h2>
        <p>The "Analysis Type" dropdown is the tool's most powerful feature. Here is a description of what each option
            measures.</p>

        <h3>Locomotor Activity</h3>
        <ul>
            <li><strong>(Pixel-based):</strong> Total distance traveled, calculated by summing the pixel distance
                between consecutive frames. <strong>Unit: Pixels</strong>.</li>
            <li><strong>(Length-based):</strong> Total distance traveled in real-world units. Requires homography to be
                set. <strong>Unit: Millimeters</strong>.</li>
            <li><strong>(DAM-based):</strong> Total number of line crossings recorded in the DAM file. <strong>Unit:
                    Counts</strong>.</li>
        </ul>

        <h3>Resting Proportion</h3>
        <ul>
            <li><strong>(DAM-based):</strong> The fraction of time intervals where the fly had zero activity counts.
                <strong>Unit: Proportion (%)</strong>.</li>
            <li><strong>(Coordinates-based):</strong> The fraction of time where the fly's coordinate was not detected
                (assumed to be resting/motionless). <strong>Unit: Proportion (%)</strong>.</li>
        </ul>

        <h3>Average Speed</h3>
        <ul>
            <li><strong>(Length-based):</strong> The average speed of the fly in real-world units. Calculated over the
                time it takes to cover 95% of its total distance to reduce the influence of terminal inactivity.
                Requires homography. <strong>Unit: mm/second</strong>.</li>
            <li><strong>(DAM-based):</strong> A proxy for speed based on activity counts over time. <strong>Unit:
                    counts/second</strong>.</li>
        </ul>

        <h3>Key Time Events</h3>
        <ul>
            <li><strong>Desiccation Time (DAM/Coordinates-based):</strong> The time of the last recorded activity for
                each fly, marking the end of its active period. <strong>Unit: Hours</strong> from the start of the
                analysis window.</li>
            <li><strong>Development Time (DAM/Coordinates-based):</strong> The time of the first recorded activity for
                each fly. <strong>Unit: Hours</strong> from the start of the analysis window.</li>
        </ul>

        <h3>Direct Comparison</h3>
        <ul>
            <li><strong>Time-series Plots (Comparison):</strong> Does not produce a boxplot. Instead, it generates two
                detailed plots showing the instantaneous speed and cumulative distance traveled over time for two
                user-selected flies, allowing for direct visual comparison of their behavior.</li>
        </ul>
    </div>
</body>

</html>
