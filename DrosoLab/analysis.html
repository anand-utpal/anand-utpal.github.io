<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Manual: Fly Tracking Analysis Tool</title>
    <style>
        body {
            font-family: 'Times New Roman', Times, serif;
            line-height: 1.6;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
        }

        .a4-container {
            width: 21cm;
            min-height: 29.7cm;
            padding: 2cm;
            margin: 1cm auto;
            border: 1px #D3D3D3 solid;
            background: white;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }

        h1,
        h2,
        h3 {
            font-family: 'Georgia', serif;
            color: #333;
        }

        h1 {
            text-align: center;
            font-size: 24pt;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
            margin-bottom: 1.5em;
        }

        h2 {
            font-size: 18pt;
            margin-top: 1.5em;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }

        h3 {
            font-size: 14pt;
            margin-top: 1.2em;
            color: #444;
        }

        p,
        li {
            font-size: 12pt;
            text-align: justify;
        }

        ul,
        ol {
            padding-left: 20px;
        }

        li {
            margin-bottom: 0.5em;
        }

        strong,
        b {
            color: #000;
        }

        .note {
            background-color: #e8f4fd;
            border-left: 4px solid #2196F3;
            padding: 10px 15px;
            margin: 1em 0;
        }

        .code {
            font-family: 'Courier New', Courier, monospace;
            background-color: #eef;
            padding: 1px 4px;
            border-radius: 3px;
        }

        @media print {

            body,
            .a4-container {
                margin: 0;
                box-shadow: none;
                border: none;
                background: white;
            }
        }
        /* --- NEW MENU STYLES --- */
.menu-container {
    position: absolute;
    top: 25px;
    left: 25px;
    z-index: 10;
}

.menu-icon {
    cursor: pointer;
    padding: 5px;
}

.menu-icon .bar {
    display: block;
    width: 25px;
    height: 3px;
    background-color: #555;
    margin: 5px 0;
}

.menu-content {
    display: none;
    /* Hidden by default */
    position: absolute;
    top: 100%;
    left: 0;
    background-color: #ffffff;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 15px;
    min-width: 180px;
}

.menu-content h4 {
    margin-top: 0;
    margin-bottom: 10px;
    color: #1e88e5;
}

.menu-content ul {
    list-style: none;
    padding: 0;
    margin: 0;
    text-align: left;
}

.menu-content ul li {
    padding: 8px 5px;
    font-size: 14px;
}

/* Show menu on hover */
.menu-container:hover .menu-content {
    display: block;
}
    </style>
</head>

<body>
            <div class="menu-container">
    <div class="menu-icon">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
    </div>
    <div class="menu-content">
        <h4>Contents</h4>
        <ul>
            <li><a href="https://theutpalanand.github.io/DrosoLab/coverpage.html">Chapter 1: Cover Page</a></li>
            <li><a href="https://theutpalanand.github.io/DrosoLab/main.html">Chapter 2: Framework</a></li>
            <li><a href="https://theutpalanand.github.io/DrosoLab/page1.html">Chapter 3: Tracking Principles</a></li>
            <li><a href="https://theutpalanand.github.io/DrosoLab/funtionsmain.html">Chapter 4: Experimental Interface</a></li>
            <li><a href="https://theutpalanand.github.io/DrosoLab/calibration.html">Chapter 5: Calibration on Image</a></li>
            <li><a href="https://theutpalanand.github.io/DrosoLab/htmlcalibration.html">Chapter 6: Calibration on Data</a></li>
            <li><a href="https://theutpalanand.github.io/DrosoLab/analysis.html">Chapter 7: Analysis</a></li>
            <li><a href="https://theutpalanand.github.io/DrosoLab/plottingapp.html">Chapter 8: Plotting App</a></li>
            <li><a href="https://theutpalanand.github.io/DrosoLab/labeledroi.html">Chapter 9: Labeling ROI</a></li>
            <li><a href="https://theutpalanand.github.io/DrosoLab/videomaking.html">Chapter 10: Video Making</a></li>
            <li><a href="https://theutpalanand.github.io/DrosoLab/error%20and%20working.html">Chapter 11: Error and Working</a></li>
        </ul>
    </div>
</div>
    <div class="a4-container">

        <h1>User Manual: Fly Tracking Analysis Tool</h1>

        <h2>1. Overview & Purpose üî¨</h2>
        <p>
            The <strong>Fly Tracking Analysis</strong> tool is a data processing application that applies a user-defined
            Region of Interest (ROI) layout to raw coordinate data from a tracking experiment. Its primary function is
            to sort the movements of multiple subjects, separating the data for each individual fly. It then performs a
            series of calculations to generate high-level analyses, such as distance traveled, activity counts, and key
            life-cycle events.
        </p>

        <hr>

        <h2>2. The User Interface üñ•Ô∏è</h2>
        <p>The interface provides a straightforward way to load your data, configure parameters, and run the analysis.
        </p>

        <h3>2.1. Input Files</h3>
        <ul>
            <li><strong>Load Database File:</strong> Click this button to open a file dialog and select the experiment's
                <code class="code">.db</code> (SQLite) file. This file contains the raw, timestamped coordinate data.
            </li>
            <li><strong>Load JSON File:</strong> Click this button to select the <code class="code">.json</code> file
                that defines the ROI layout. This file tells the program where each fly's arena is located on the
                screen.</li>
        </ul>

        <h3>2.2. Output Location</h3>
        <ul>
            <li><strong>Select Output Directory:</strong> Click this button to choose the folder where the resulting
                four CSV analysis files will be saved.</li>
        </ul>

        <h3>2.3. Analysis Parameters</h3>
        <ul>
            <li><strong>Analysis Interval (seconds):</strong> Enter a number to define the length of the time bins for
                the locomotor and DAM activity reports. For example, a value of <code class="code">60</code> will
                summarize activity in 1-minute intervals.</li>
            <li><strong>Gap Threshold for Desiccation (minutes):</strong> This critical value helps estimate the time of
                death or inactivity. Enter the maximum allowed time gap (in minutes) between two consecutive detections
                of a fly. If a fly disappears for longer than this threshold, the script considers its last seen point
                as its final time of activity.</li>
            <li><strong>Fly Numbering Order:</strong> This dropdown menu controls how flies are numbered based on the
                ROI layout:
                <ul>
                    <li><strong>Normal (Top-Left to Bottom-Right):</strong> Standard reading order.</li>
                    <li><strong>Reverse (Bottom-Right to Top-Left):</strong> The opposite order.</li>
                </ul>
            </li>
        </ul>

        <h3>2.4. Execution and Feedback</h3>
        <ul>
            <li><strong>Run Analysis:</strong> After loading the necessary files and setting parameters, click this
                button to start the process.</li>
            <li><strong>Analysis Progress:</strong> The progress bar fills up as the application processes the data,
                providing a visual indicator of completion.</li>
            <li><strong>Status Label:</strong> This text area at the bottom provides real-time feedback, such as
                "Database loaded successfully," "Analysis running...," or "Analysis completed successfully."</li>
        </ul>

        <hr>

        <h2>3. The Sorting and Numbering Logic üî¢</h2>
        <p>
            Before any analysis can occur, the tool must assign a consistent number (e.g., Fly 1, Fly 2) to each
            individual ROI. This is crucial for tracking individuals over time and is determined by the "Fly Numbering
            Order" you select.
        </p>

        <h4>Normal Order (Top-Left to Bottom-Right)</h4>
        <ol>
            <li><b>Group by Column:</b> ROIs are grouped based on their horizontal position (similar 'left' coordinate).
            </li>
            <li><b>Sort Groups:</b> These groups are sorted from <strong>left to right</strong>.</li>
            <li><b>Sort Within Groups:</b> ROIs within each group are sorted from <strong>top to bottom</strong>.</li>
            <li><b>Assign Numbers:</b> Flies are numbered sequentially based on this final sorted order.</li>
        </ol>

        <h4>Reverse Order (Bottom-Right to Top-Left)</h4>
        <ol>
            <li><b>Group by Column:</b> ROIs are grouped by their 'right' coordinate.</li>
            <li><b>Sort Groups:</b> Groups are sorted from <strong>right to left</strong>.</li>
            <li><b>Sort Within Groups:</b> ROIs are sorted from <strong>bottom to top</strong>.</li>
            <li><b>Assign Numbers:</b> Numbers are assigned to this reverse-sorted list.</li>
        </ol>

        <hr>

        <h2>4. The Core Processing Loop üîÑ</h2>
        <p>
            For each timestamp in the input database, the script reads the list of detected coordinates and performs the
            following actions:
        </p>
        <ol>
            <li><strong>Coordinate Assignment:</strong> It checks which defined ROI each coordinate point falls into.
            </li>
            <li><strong>One Fly, One Coordinate:</strong> The logic ensures only one coordinate is assigned to each
                fly's ROI per timestamp.</li>
            <li><strong>Handling "Dumped" Data:</strong> Any coordinate that does not fall into a defined ROI is
                considered "dumped" (noise or stray flies).</li>
            <li><strong>Metric Calculation:</strong> For each assigned coordinate, the script updates:
                <ul>
                    <li><strong>Distance Traveled:</strong> The distance from the fly's previous position.</li>
                    <li><strong>DAM Counts:</strong> A counter is incremented if the fly crosses the "middle line" in
                        its ROI.</li>
                </ul>
            </li>
        </ol>

        <hr>

        <h2>5. The Output Files üìÑ</h2>
        <p>The analysis generates four distinct CSV files, each providing a different level of data abstraction.</p>

        <h3>5.1. sorted_output.csv</h3>
        <p>The main, frame-by-frame log of the experiment, with data sorted by fly.</p>
        <ul>
            <li><code class="code">timestamp</code> / <code class="code">timestamp_ist</code>: The timestamp for each
                frame.</li>
            <li><code class="code">fly_X_x</code> / <code class="code">fly_X_y</code>: The x and y pixel coordinate for
                each fly. The value is <code class="code">NaN</code> if the fly was not detected.</li>
            <li><code class="code">dumped</code>: The number of unassigned coordinates in that frame. A value of -1
                indicates a major disturbance.</li>
        </ul>

        <h3>5.2. development_desiccation.csv</h3>
        <p>A high-level summary of each fly's lifespan within the experiment.</p>
        <ul>
            <li><code class="code">fly</code>: The identifier for each fly (e.g., 'fly1').</li>
            <li><code class="code">development_time_ist</code>: The time when the fly was <strong>first
                    detected</strong>.</li>
            <li><code class="code">desiccation_time_ist</code>: The estimated time of death/inactivity, determined by
                finding the last recorded movement before a long gap (defined by the "Gap Threshold").</li>
        </ul>

        <h3>5.3. locomotor_activity.csv</h3>
        <p>Summarizes the total distance traveled by each fly over the user-defined time intervals.</p>
        <ul>
            <li><code class="code">start_time_ist</code>: The beginning of the time interval.</li>
            <li><code class="code">fly_X_distance</code>: The total <strong>distance in pixels</strong> traveled during
                the interval.</li>
            <li><code class="code">fly_X_distance_mm</code>: The total <strong>distance in millimeters</strong> traveled
                (if distance calibration was provided).</li>
        </ul>

        <h3>5.4. dam.csv</h3>
        <p>Mimics the output of a traditional Drosophila Activity Monitor (DAM) system.</p>
        <ul>
            <li><code class="code">start_time_ist</code>: The beginning of the time interval.</li>
            <li><code class="code">fly_X_count</code>: The total number of times the fly crossed the vertical "middle
                line" within its ROI during the interval.</li>
        </ul>
    </div>
</body>

</html>
